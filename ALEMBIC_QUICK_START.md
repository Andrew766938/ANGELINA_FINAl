# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ Alembic –º–∏–≥—Ä–∞—Ü–∏–π

## ‚úÖ –£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úì –û–±–Ω–æ–≤–ª–µ–Ω `migrations/env.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- ‚úì –û–±–Ω–æ–≤–ª–µ–Ω `alembic.ini` - URL –ë–î –ø—É—Å—Ç–æ–π (–ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ settings)
- ‚úì –í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π Base –∏–∑ `app.database.database`

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1Ô∏è‚É£ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# Linux/Mac
alembic revision --autogenerate -m "initial: create airports flights bookings tables"

# Windows
alembic.exe revision --autogenerate -m "initial: create airports flights bookings tables"
```

### 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª —Ç–∏–ø–∞ `migrations/versions/001_initial...py`

–û—Ç–∫—Ä–æ–π –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–∏–¥–∏—à—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã:
- `airports`
- `flights`
- `bookings`
- `users` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `roles` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `payments` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### 3Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# Linux/Mac
alembic upgrade head

# Windows
alembic.exe upgrade head
```

### 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
alembic current

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ –ë–î
sqlite3 test.db ".tables"
```

## üîÑ –¢–∏–ø–∏—á–Ω—ã–π workflow

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å:

```python
# 1. –ò–∑–º–µ–Ω–∏ –º–æ–¥–µ–ª—å –≤ app/models/
class FlightModel(Base):
    __tablename__ = "flights"
    # ...
    status = Column(String(20), default="active")  # ‚Üê –Ω–æ–≤–æ–µ –ø–æ–ª–µ
```

```bash
# 2. –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "add status field to flights"

# 3. –ü—Ä–∏–º–µ–Ω–∏
alembic upgrade head
```

### –û—Ç–∫–∞—Ç –Ω–∞ —à–∞–≥ –Ω–∞–∑–∞–¥:

```bash
alembic downgrade -1
```

### –û—Ç–∫–∞—Ç –∫–æ –≤—Å–µ–º—É –Ω–∞—á–∞–ª—É (–æ—á–∏—Å—Ç–∏—Ç—å –ë–î):

```bash
alembic downgrade base
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã –≤ `migrations/versions/` –≤—Ä—É—á–Ω—É—é
2. **–í–°–ï–ì–î–ê** —Å–æ–∑–¥–∞–≤–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
3. **–ü–ï–†–ï–î** –¥–µ–ø–ª–æ–µ–º –∑–∞–ø—É—Å—Ç–∏ `alembic upgrade head`
4. **–ò–°–ü–û–õ–¨–ó–£–ô** —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã `alembic revision` –∏ `alembic upgrade/downgrade`

## üìö –í—Å–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–µ—Ä—Å–∏–∏
alembic current

# –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –¥–æ —Ç–µ–∫—É—â–µ–π
alembic history -r base:heads

# –û—Ç–∫–∞—Ç –Ω–∞ 1 –≤–µ—Ä—Å–∏—é
alembic downgrade -1

# –û—Ç–∫–∞—Ç –Ω–∞ 3 –≤–µ—Ä—Å–∏–∏
alembic downgrade -3

# –û—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (–ø–æ ID)
alembic downgrade <revision_id>

# –û—Ç–∫–∞—Ç –∫–æ –≤—Å–µ–º—É –Ω–∞—á–∞–ª—É
alembic downgrade base

# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è
alembic revision -m "custom migration"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
alembic upgrade <revision_id>

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
alembic revision --autogenerate -m "description"
```

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç:
- üìä –°–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –ë–î (–∞ –Ω–µ –≤ –ø–∞–º—è—Ç–∏)
- üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
- üõ°Ô∏è –ë—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- üìà –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è

üéâ **–ü—Ä–æ—Ñ–∏—Ç!**
