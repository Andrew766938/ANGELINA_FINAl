<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úàÔ∏è –ö—Ä—ã–ª—å—è –æ–Ω–ª–∞–π–Ω</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- ============== AUTH MODAL ============== -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-container">
            <div class="auth-box">
                <h1>‚úàÔ∏è –ö—Ä—ã–ª—å—è</h1>
                <p class="subtitle">–û–Ω–ª–∞–π–Ω —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤–∏–∞–±–∏–ª–µ—Ç–æ–≤</p>
                
                <!-- LOGIN FORM -->
                <div id="login-form" class="auth-form active">
                    <h2>–í—Ö–æ–¥</h2>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="login-email" placeholder="demo@example.com" value="demo@example.com">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="login-password" placeholder="demo123" value="demo123">
                    </div>
                    <button class="btn-auth" onclick="login()">üîì –í–û–ô–¢–ò</button>
                    <p class="auth-link">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="switchAuthForm()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                </div>
                
                <!-- REGISTER FORM -->
                <div id="register-form" class="auth-form">
                    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <div class="form-group">
                        <label>–§–ò–û</label>
                        <input type="text" id="register-name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="register-email" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="register-password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>
                    <button class="btn-auth" onclick="register()">‚úçÔ∏è –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
                    <p class="auth-link">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="switchAuthForm()">–í–æ–π—Ç–∏</a></p>
                </div>
                
                <div class="divider"><span>–ò–õ–ò</span></div>
                <button class="btn-guest" onclick="guestLogin()">üë§ –ì–û–°–¢–¨</button>
            </div>
        </div>
    </div>


    <!-- ============== MAIN APP ============== -->
    <div id="app" class="app hidden">
        <!-- NAVBAR -->
        <nav class="navbar">
            <div class="navbar-brand">
                <h1>‚úàÔ∏è –ö—Ä—ã–ª—å—è</h1>
            </div>
            <div class="navbar-menu">
                <button class="nav-btn active" onclick="switchMainTab('flights')">üõ´ –†–µ–π—Å—ã</button>
                <button class="nav-btn" onclick="switchMainTab('airports')">üè¢ –ê—ç—Ä–æ–ø–æ—Ä—Ç—ã</button>
                <button class="nav-btn" onclick="switchMainTab('bookings')">üé´ –ë–∏–ª–µ—Ç—ã</button>
                <button class="nav-btn" onclick="switchMainTab('account')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
                <button class="nav-btn logout" onclick="logout()">üö™ –í–´–•–û–î</button>
            </div>
        </nav>


        <div class="container">
            <!-- ============== FLIGHTS TAB ============== -->
            <div id="flights" class="tab active">
                <h2>üõ´ –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤</h2>
                
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchFlightTab('all')">üìã –í—Å–µ —Ä–µ–π—Å—ã</button>
                    <button class="tab-btn" onclick="switchFlightTab('search')">üîç –ü–æ–∏—Å–∫</button>
                </div>


                <!-- All Flights -->
                <div id="all-flights-tab" class="tab active">
                    <button class="btn-primary" onclick="loadAllFlights()" style="margin-bottom: 20px; max-width: 200px;">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ</button>
                    <div id="flights-list" class="cards-grid"></div>
                </div>


                <!-- Search Flights -->
                <div id="search-flights-tab" class="tab">
                    <div class="form-card">
                        <h3>üîç –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤</h3>
                        <div class="form-row">
                            <input type="number" id="search-from" placeholder="ID –æ—Ç–∫—É–¥–∞">
                            <input type="number" id="search-to" placeholder="ID –∫—É–¥–∞">
                        </div>
                        <button class="btn-primary" onclick="searchFlights()">üîé –ù–ê–ô–¢–ò</button>
                    </div>
                    <div id="search-results" class="cards-grid"></div>
                </div>
            </div>


            <!-- ============== AIRPORTS TAB ============== -->
            <div id="airports" class="tab">
                <h2>üè¢ –ê—ç—Ä–æ–ø–æ—Ä—Ç—ã</h2>
                
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchAirportTab('list')">üìã –°–ø–∏—Å–æ–∫</button>
                    <button class="tab-btn" onclick="switchAirportTab('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>


                <!-- Airport List -->
                <div id="airport-list-tab" class="tab active">
                    <button class="btn-primary" onclick="loadAllAirports()" style="margin-bottom: 20px; max-width: 200px;">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <div id="airports-list" class="cards-grid"></div>
                </div>


                <!-- Add Airport -->
                <div id="airport-add-tab" class="tab">
                    <div class="form-card">
                        <h3>‚ûï –ù–æ–≤—ã–π –∞—ç—Ä–æ–ø–æ—Ä—Ç</h3>
                        <div class="form-row">
                            <input type="text" id="airport-code" placeholder="–ö–æ–¥ (MOW)" maxlength="3">
                            <input type="text" id="airport-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                        </div>
                        <div class="form-row">
                            <input type="text" id="airport-city" placeholder="–ì–æ—Ä–æ–¥">
                            <input type="text" id="airport-country" placeholder="–°—Ç—Ä–∞–Ω–∞">
                        </div>
                        <button class="btn-primary" onclick="addAirport()">‚úÖ –î–û–ë–ê–í–ò–¢–¨</button>
                    </div>
                </div>
            </div>


            <!-- ============== BOOKINGS TAB ============== -->
            <div id="bookings" class="tab">
                <h2>üé´ –ú–æ–∏ –±–∏–ª–µ—Ç—ã</h2>
                
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchBookingTab('list')">üìã –ú–æ–∏ –±–∏–ª–µ—Ç—ã</button>
                    <button class="tab-btn" onclick="switchBookingTab('new')">üéüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>


                <!-- My Bookings -->
                <div id="booking-list-tab" class="tab active">
                    <button class="btn-primary" onclick="loadMyBookings()" style="margin-bottom: 20px; max-width: 200px;">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <div id="bookings-list" class="cards-grid"></div>
                </div>


                <!-- New Booking -->
                <div id="booking-new-tab" class="tab">
                    <div class="form-card">
                        <h3>üéüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç</h3>
                        <div class="form-row">
                            <input type="number" id="booking-flight" placeholder="ID —Ä–µ–π—Å–∞" min="1">
                        </div>
                        <div class="form-row">
                            <input type="text" id="booking-name" placeholder="–§–ò–û –ø–∞—Å—Å–∞–∂–∏—Ä–∞">
                            <input type="email" id="booking-email" placeholder="Email">
                        </div>
                        <div class="form-row">
                            <input type="tel" id="booking-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
                        </div>
                        <button class="btn-primary" onclick="createBooking()">‚úÖ –ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨</button>
                    </div>
                </div>
            </div>


            <!-- ============== ACCOUNT TAB ============== -->
            <div id="account" class="tab">
                <h2>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                
                <div class="account-section">
                    <h3>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <p>
                        <strong>–§–ò–û:</strong>
                        <span id="acc-name">-</span>
                    </p>
                    <p>
                        <strong>Email:</strong>
                        <span id="acc-email">-</span>
                    </p>
                    <p>
                        <strong>–¢–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞:</strong>
                        <span id="acc-type">-</span>
                    </p>
                    <p>
                        <strong>–î–∞—Ç–∞ –≤—Ö–æ–¥–∞:</strong>
                        <span id="acc-date">-</span>
                    </p>
                </div>
            </div>
        </div>
    </div>


    <!-- NOTIFICATION -->
    <div id="notification" class="notification"></div>


    <script>
        const API_URL = 'http://localhost:8000';
        let currentUser = null;

        // ---------- –î–ï–ú–û-–î–ê–ù–ù–´–ï ----------
        const DEMO_AIRPORTS = [
            { id: 1, code: 'MOW', name: '–®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ', city: '–ú–æ—Å–∫–≤–∞', country: '–†–æ—Å—Å–∏—è' },
            { id: 2, code: 'SPB', name: '–ü—É–ª–∫–æ–≤–æ', city: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', country: '–†–æ—Å—Å–∏—è' },
            { id: 3, code: 'KZN', name: '–ö–∞–∑–∞–Ω—å', city: '–ö–∞–∑–∞–Ω—å', country: '–†–æ—Å—Å–∏—è' },
            { id: 4, code: 'SVX', name: '–ö–æ–ª—å—Ü–æ–≤–æ', city: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', country: '–†–æ—Å—Å–∏—è' },
            { id: 5, code: 'YKA', name: '–ü–ª–æ—â–∞–¥—å –õ–µ–Ω–∏–Ω–∞', city: '–Ø–∫—É—Ç—Å–∫', country: '–†–æ—Å—Å–∏—è' },
            { id: 6, code: 'LED', name: '–ü—É–ª–∫–æ–≤–æ-2', city: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', country: '–†–æ—Å—Å–∏—è' },
            { id: 7, code: 'NOV', name: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', city: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', country: '–†–æ—Å—Å–∏—è' },
            { id: 8, code: 'VVO', name: '–ù–æ–≤—ã–π –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', city: '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', country: '–†–æ—Å—Å–∏—è' },
            { id: 9, code: 'OVB', name: '–û–±—å', city: '–û–±—å', country: '–†–æ—Å—Å–∏—è' },
            { id: 10, code: 'UUS', name: '–Æ–∂–Ω–æ—Å–∞—Ö–∞–ª–∏–Ω—Å–∫', city: '–Æ–∂–Ω–æ—Å–∞—Ö–∞–ª–∏–Ω—Å–∫', country: '–†–æ—Å—Å–∏—è' },
            { id: 11, code: 'TOE', name: '–¢–æ–ª—è—Ç–∏', city: '–¢–æ–ª—è—Ç–∏', country: '–†–æ—Å—Å–∏—è' },
            { id: 12, code: 'PEE', name: '–ü–µ—Ä–º—å', city: '–ü–µ—Ä–º—å', country: '–†–æ—Å—Å–∏—è' },
            { id: 13, code: 'TJM', name: '–¢—é–º–µ–Ω—å', city: '–¢—é–º–µ–Ω—å', country: '–†–æ—Å—Å–∏—è' },
            { id: 14, code: 'IGT', name: '–ò—Ä–∫—É—Ç—Å–∫', city: '–ò—Ä–∫—É—Ç—Å–∫', country: '–†–æ—Å—Å–∏—è' },
            { id: 15, code: 'ULY', name: '–£–ª–∞–Ω-–£–¥—ç', city: '–£–ª–∞–Ω-–£–¥—ç', country: '–†–æ—Å—Å–∏—è' },
            { id: 16, code: 'CHI', name: '–ß–∏—Ç–∞', city: '–ß–∏—Ç–∞', country: '–†–æ—Å—Å–∏—è' },
        ];

        const DEMO_FLIGHTS = [
            { id: 1, flight_number: 'SU-001', airline: '–ê—ç—Ä–æ—Ñ–ª–æ—Ç', departure_airport_id: 1, arrival_airport_id: 2, departure_time: new Date().toISOString(), price: 5500, total_seats: 180, available_seats: 180 },
            { id: 2, flight_number: 'SU-002', airline: '–ê—ç—Ä–æ—Ñ–ª–æ—Ç', departure_airport_id: 2, arrival_airport_id: 1, departure_time: new Date().toISOString(), price: 5500, total_seats: 180, available_seats: 145 },
            { id: 3, flight_number: 'U6-100', airline: '–£—Ä–∞–ª—å—Å–∫–∏–µ –∞–≤–∏–∞–ª–∏–Ω–∏–∏', departure_airport_id: 1, arrival_airport_id: 3, departure_time: new Date().toISOString(), price: 4800, total_seats: 150, available_seats: 150 },
            { id: 4, flight_number: 'UT-50', airline: '–Æ—Ç-–ê—ç—Ä', departure_airport_id: 3, arrival_airport_id: 4, departure_time: new Date().toISOString(), price: 6200, total_seats: 160, available_seats: 160 },
            { id: 5, flight_number: 'S7-500', airline: 'S7 –ê–≤–∏–∞–ª–∏–Ω–∏–∏', departure_airport_id: 2, arrival_airport_id: 4, departure_time: new Date().toISOString(), price: 7200, total_seats: 120, available_seats: 120 },
            { id: 6, flight_number: 'SU-003', airline: '–ê—ç—Ä–æ—Ñ–ª–æ—Ç', departure_airport_id: 1, arrival_airport_id: 5, departure_time: new Date().toISOString(), price: 8500, total_seats: 200, available_seats: 200 },
            { id: 7, flight_number: 'FV-201', airline: '–§–∏–Ω–∏—Ä –∞—ç—Ä–æ', departure_airport_id: 4, arrival_airport_id: 2, departure_time: new Date().toISOString(), price: 6800, total_seats: 140, available_seats: 140 },
            { id: 8, flight_number: 'A4-400', airline: 'A4', departure_airport_id: 1, arrival_airport_id: 6, departure_time: new Date().toISOString(), price: 5200, total_seats: 190, available_seats: 190 },
            { id: 9, flight_number: 'R2-102', airline: '–†—É—Å—Å–∫–∏–µ –∞–≤–∏–∞–ª–∏–Ω–∏–∏', departure_airport_id: 2, arrival_airport_id: 3, departure_time: new Date().toISOString(), price: 5800, total_seats: 170, available_seats: 170 },
            { id: 10, flight_number: 'FP-55', airline: '–§–ª–∞–º–∏–Ω–≥–æ', departure_airport_id: 3, arrival_airport_id: 1, departure_time: new Date().toISOString(), price: 5400, total_seats: 160, available_seats: 160 },
            { id: 11, flight_number: 'N1-555', airline: '–ù–æ–≤—ã–µ –≤–µ–∫–∞', departure_airport_id: 1, arrival_airport_id: 7, departure_time: new Date().toISOString(), price: 7800, total_seats: 210, available_seats: 210 },
            { id: 12, flight_number: 'V1-888', airline: '–í—ã—Å–æ—Ç–∞', departure_airport_id: 2, arrival_airport_id: 8, departure_time: new Date().toISOString(), price: 8200, total_seats: 140, available_seats: 140 },
            { id: 13, flight_number: 'E3-200', airline: '–≠–∫—Å–ø—Ä–µ—Å—Å', departure_airport_id: 1, arrival_airport_id: 4, departure_time: new Date().toISOString(), price: 6500, total_seats: 150, available_seats: 150 },
            { id: 14, flight_number: 'G5-777', airline: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', departure_airport_id: 3, arrival_airport_id: 2, departure_time: new Date().toISOString(), price: 5700, total_seats: 180, available_seats: 180 },
            { id: 15, flight_number: 'T4-999', airline: '–¢–∞–Ω–¥–µ–º', departure_airport_id: 4, arrival_airport_id: 3, departure_time: new Date().toISOString(), price: 4200, total_seats: 120, available_seats: 120 },
            { id: 16, flight_number: 'L7-333', airline: '–õ—É—á', departure_airport_id: 1, arrival_airport_id: 9, departure_time: new Date().toISOString(), price: 9200, total_seats: 200, available_seats: 200 },
        ];

        const DEMO_BOOKINGS = [
            { id: 1, booking_number: 'BK-001', passenger_name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', passenger_email: 'ivan@example.com', passenger_phone: '+7 999 111-00-01', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 2, booking_number: 'BK-002', passenger_name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', passenger_email: 'maria@example.com', passenger_phone: '+7 999 222-00-02', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 3, booking_number: 'BK-003', passenger_name: '–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤', passenger_email: 'alex@example.com', passenger_phone: '+7 999 333-00-03', status: '–ó–ê–í–ï–†–®–ï–ù–û' },
            { id: 4, booking_number: 'BK-004', passenger_name: '–ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞', passenger_email: 'elena@example.com', passenger_phone: '+7 999 444-00-04', status: '–û–ñ–ò–î–ê–ù–ò–ï' },
            { id: 5, booking_number: 'BK-005', passenger_name: '–°–µ—Ä–≥–µ–π –§–µ–¥–æ—Ä–æ–≤', passenger_email: 'sergey@example.com', passenger_phone: '+7 999 555-00-05', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 6, booking_number: 'BK-006', passenger_name: '–û–ª—å–≥–∞ –ù–æ–≤–∏–∫–æ–≤–∞', passenger_email: 'olga@example.com', passenger_phone: '+7 999 666-00-06', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 7, booking_number: 'BK-007', passenger_name: '–í–∏–∫—Ç–æ—Ä –ö–æ–∑–ª–æ–≤', passenger_email: 'victor@example.com', passenger_phone: '+7 999 777-00-07', status: '–ó–ê–í–ï–†–®–ï–ù–û' },
            { id: 8, booking_number: 'BK-008', passenger_name: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –í–æ–ª–∫–æ–≤–∞', passenger_email: 'kate@example.com', passenger_phone: '+7 999 888-00-08', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 9, booking_number: 'BK-009', passenger_name: '–ú–∞–∫—Å–∏–º –°–æ–∫–æ–ª–æ–≤', passenger_email: 'max@example.com', passenger_phone: '+7 999 900-00-09', status: '–û–ñ–ò–î–ê–ù–ò–ï' },
            { id: 10, booking_number: 'BK-010', passenger_name: '–ù–∞—Ç–∞–ª—å—è –°—Ç–µ–ø–∞–Ω–æ–≤–∞', passenger_email: 'nata@example.com', passenger_phone: '+7 999 101-00-10', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 11, booking_number: 'BK-011', passenger_name: '–ü–∞–≤–µ–ª –ú–æ—Ä–æ–∑–æ–≤', passenger_email: 'pavel@example.com', passenger_phone: '+7 999 202-00-11', status: '–ó–ê–í–ï–†–®–ï–ù–û' },
            { id: 12, booking_number: 'BK-012', passenger_name: '–ê–Ω–Ω–∞ –ë—É–ª–∞–Ω–æ–≤–∞', passenger_email: 'anna@example.com', passenger_phone: '+7 999 303-00-12', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 13, booking_number: 'BK-013', passenger_name: '–î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤', passenger_email: 'dmitry@example.com', passenger_phone: '+7 999 404-00-13', status: '–û–ñ–ò–î–ê–ù–ò–ï' },
            { id: 14, booking_number: 'BK-014', passenger_name: '–í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –°–æ–ª–æ–≤—å–µ–≤–∞', passenger_email: 'val@example.com', passenger_phone: '+7 999 505-00-14', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
            { id: 15, booking_number: 'BK-015', passenger_name: '–†—É—Å–ª–∞–Ω –ö—É–∑–Ω–µ—Ü–æ–≤', passenger_email: 'ruslan@example.com', passenger_phone: '+7 999 606-00-15', status: '–ó–ê–í–ï–†–®–ï–ù–û' },
            { id: 16, booking_number: 'BK-016', passenger_name: '–õ—é–¥–º–∏–ª–∞ –í–æ–ª–æ—Ö–æ–≤–∞', passenger_email: 'lyuda@example.com', passenger_phone: '+7 999 707-00-16', status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û' },
        ];

        // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('user');
            if (saved) {
                currentUser = JSON.parse(saved);
                showApp();
            } else {
                showAuthModal();
            }
        });

        // ---------- AUTH ----------
        function switchAuthForm() {
            document.getElementById('login-form').classList.toggle('active');
            document.getElementById('register-form').classList.toggle('active');
        }

        function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            if (!email || !password) {
                notify('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            currentUser = {
                name: email.split('@')[0],
                email: email,
                type: 'registered',
                loginTime: new Date().toLocaleString('ru-RU')
            };
            localStorage.setItem('user', JSON.stringify(currentUser));
            showApp();
            notify('‚úÖ –£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!', 'success');
        }

        function register() {
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value.trim();
            if (!name || !email || !password) {
                notify('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            currentUser = {
                name: name,
                email: email,
                type: 'registered',
                loginTime: new Date().toLocaleString('ru-RU')
            };
            localStorage.setItem('user', JSON.stringify(currentUser));
            showApp();
            notify('‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }

        function guestLogin() {
            currentUser = {
                name: '–ì–æ—Å—Ç—å',
                email: 'guest@example.com',
                type: 'guest',
                loginTime: new Date().toLocaleString('ru-RU')
            };
            localStorage.setItem('user', JSON.stringify(currentUser));
            showApp();
            notify('‚úÖ –í–æ—à–ª–∏ –∫–∞–∫ –≥–æ—Å—Ç—å', 'success');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('user');
            showAuthModal();
            document.getElementById('login-email').value = 'demo@example.com';
            document.getElementById('login-password').value = 'demo123';
            notify('‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'success');
        }

        // ---------- UI ----------
        function showAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            updateAccountTab();
            loadAllFlights();
            loadAllAirports();
            loadMyBookings();
        }

        function switchMainTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn:not(.logout)').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            const map = { flights: 0, airports: 1, bookings: 2, account: 3 };
            const idx = map[tabName];
            const btns = document.querySelectorAll('.nav-btn:not(.logout)');
            if (idx !== undefined && btns[idx]) btns[idx].classList.add('active');
        }

        function switchFlightTab(tab) {
            document.getElementById('all-flights-tab').classList.toggle('active', tab === 'all');
            document.getElementById('search-flights-tab').classList.toggle('active', tab === 'search');
            document.querySelectorAll('#flights .tab-btn').forEach((b, i) => {
                b.classList.toggle('active', (i === 0 && tab === 'all') || (i === 1 && tab === 'search'));
            });
        }

        function switchAirportTab(tab) {
            document.getElementById('airport-list-tab').classList.toggle('active', tab === 'list');
            document.getElementById('airport-add-tab').classList.toggle('active', tab === 'add');
            document.querySelectorAll('#airports .tab-btn').forEach((b, i) => {
                b.classList.toggle('active', (i === 0 && tab === 'list') || (i === 1 && tab === 'add'));
            });
        }

        function switchBookingTab(tab) {
            document.getElementById('booking-list-tab').classList.toggle('active', tab === 'list');
            document.getElementById('booking-new-tab').classList.toggle('active', tab === 'new');
            document.querySelectorAll('#bookings .tab-btn').forEach((b, i) => {
                b.classList.toggle('active', (i === 0 && tab === 'list') || (i === 1 && tab === 'new'));
            });
        }

        function notify(msg, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.className = `notification show ${type}`;
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // ---------- ACCOUNT ----------
        function updateAccountTab() {
            if (!currentUser) return;
            document.getElementById('acc-name').textContent = currentUser.name;
            document.getElementById('acc-email').textContent = currentUser.email;
            document.getElementById('acc-type').textContent = currentUser.type === 'guest' ? 'üë§ –ì–æ—Å—Ç—å' : '‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω';
            document.getElementById('acc-date').textContent = currentUser.loginTime;
        }

        // ---------- FLIGHTS ----------
        async function loadAllFlights() {
            const list = document.getElementById('flights-list');
            try {
                const res = await fetch(`${API_URL}/flights/`);
                if (!res.ok) throw new Error();
                const flights = await res.json();
                if (!flights || flights.length === 0) throw new Error();
                renderFlights(list, flights);
            } catch {
                renderFlights(list, DEMO_FLIGHTS);
                notify('‚ÑπÔ∏è –ü–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–π—Å–æ–≤ (demo)', 'warning');
            }
        }

        function renderFlights(list, flights) {
            list.innerHTML = flights.map(f => `
                <div class="card">
                    <h3>${f.flight_number}</h3>
                    <p><strong>üé´ ${f.airline}</strong></p>
                    <p><strong>üìç –ú–∞—Ä—à—Ä—É—Ç:</strong> ${f.departure_airport_id} ‚û°Ô∏è ${f.arrival_airport_id}</p>
                    <p><strong>‚è∞ –í—ã–ª–µ—Ç:</strong> ${new Date(f.departure_time).toLocaleString('ru-RU')}</p>
                    <p><strong>üí∞ –¶–µ–Ω–∞:</strong> <span style="color: #48bb78; font-weight: 700;">‚ÇΩ${f.price}</span></p>
                    <p><strong>üí∫ –ú–µ—Å—Ç–∞:</strong> ${f.available_seats}/${f.total_seats}</p>
                    <button class="btn-select" onclick="selectFlight(${f.id})">üéüÔ∏è –ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨</button>
                </div>
            `).join('');
        }

        async function searchFlights() {
            const from = document.getElementById('search-from').value.trim();
            const to = document.getElementById('search-to').value.trim();
            if (!from || !to) {
                notify('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –û–ë–ê –ø–æ–ª—è', 'error');
                return;
            }
            const list = document.getElementById('search-results');
            try {
                const res = await fetch(`${API_URL}/flights/?departure_airport_id=${from}&arrival_airport_id=${to}`);
                if (!res.ok) throw new Error();
                const flights = await res.json();
                if (!flights || flights.length === 0) {
                    list.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #a0aec0; padding: 40px;">‚úàÔ∏è –†–µ–π—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                    return;
                }
                renderFlights(list, flights);
                notify(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${flights.length} —Ä–µ–π—Å–æ–≤`, 'success');
            } catch {
                list.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #a0aec0; padding: 40px;">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ</div>';
            }
        }

        function selectFlight(id) {
            document.getElementById('booking-flight').value = id;
            switchMainTab('bookings');
            switchBookingTab('new');
        }

        // ---------- AIRPORTS ----------
        async function loadAllAirports() {
            const list = document.getElementById('airports-list');
            try {
                const res = await fetch(`${API_URL}/flights/airports/`);
                if (!res.ok) throw new Error();
                const airports = await res.json();
                if (!airports || airports.length === 0) throw new Error();
                renderAirports(list, airports);
            } catch {
                renderAirports(list, DEMO_AIRPORTS);
                notify('‚ÑπÔ∏è –ü–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ (demo)', 'warning');
            }
        }

        function renderAirports(list, airports) {
            list.innerHTML = airports.map(a => `
                <div class="card">
                    <h3>‚úàÔ∏è ${a.code}</h3>
                    <p><strong>${a.name}</strong></p>
                    <p><strong>üèôÔ∏è –ì–æ—Ä–æ–¥:</strong> ${a.city}</p>
                    <p><strong>üåç –°—Ç—Ä–∞–Ω–∞:</strong> ${a.country}</p>
                </div>
            `).join('');
        }

        async function addAirport() {
            const code = document.getElementById('airport-code').value.trim().toUpperCase();
            const name = document.getElementById('airport-name').value.trim();
            const city = document.getElementById('airport-city').value.trim();
            const country = document.getElementById('airport-country').value.trim();
            if (!code || !name || !city || !country) {
                notify('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –ø–æ–ª—è', 'error');
                return;
            }
            try {
                const res = await fetch(`${API_URL}/flights/airports`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, name, city, country })
                });
                if (res.ok) {
                    notify('‚úÖ –ê—ç—Ä–æ–ø–æ—Ä—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    document.getElementById('airport-code').value = '';
                    document.getElementById('airport-name').value = '';
                    document.getElementById('airport-city').value = '';
                    document.getElementById('airport-country').value = '';
                    setTimeout(() => loadAllAirports(), 500);
                } else {
                    notify('‚ùå –û—à–∏–±–∫–∞', 'error');
                }
            } catch {
                notify('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }

        // ---------- BOOKINGS ----------
        async function loadMyBookings() {
            const list = document.getElementById('bookings-list');
            try {
                const res = await fetch(`${API_URL}/bookings/`);
                if (!res.ok) throw new Error();
                const bookings = await res.json();
                if (!bookings || bookings.length === 0) throw new Error();
                renderBookings(list, bookings);
            } catch {
                renderBookings(list, DEMO_BOOKINGS);
                notify('‚ÑπÔ∏è –ü–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –±–∏–ª–µ—Ç–æ–≤ (demo)', 'warning');
            }
        }

        function renderBookings(list, bookings) {
            list.innerHTML = bookings.map(b => `
                <div class="card">
                    <h3>üé´ ‚Ññ${b.booking_number || b.id}</h3>
                    <p><strong>üë§ –ü–∞—Å—Å–∞–∂–∏—Ä:</strong> ${b.passenger_name}</p>
                    <p><strong>üìß Email:</strong> ${b.passenger_email}</p>
                    <p><strong>üì± –¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${b.passenger_phone}</p>
                    <p><strong>‚úÖ –°—Ç–∞—Ç—É—Å:</strong> <span style="color: #48bb78; font-weight: 700;">${b.status || '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û'}</span></p>
                </div>
            `).join('');
        }

        async function createBooking() {
            const flight = document.getElementById('booking-flight').value.trim();
            const name = document.getElementById('booking-name').value.trim();
            const email = document.getElementById('booking-email').value.trim();
            const phone = document.getElementById('booking-phone').value.trim();
            if (!flight || !name || !email || !phone) {
                notify('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –ø–æ–ª—è', 'error');
                return;
            }
            try {
                const res = await fetch(`${API_URL}/bookings/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        flight_id: parseInt(flight),
                        passenger_name: name,
                        passenger_email: email,
                        passenger_phone: phone
                    })
                });
                if (res.ok) {
                    const booking = await res.json();
                    notify(`‚úÖ –ë–∏–ª–µ—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω! ‚Ññ${booking.booking_number || flight}`, 'success');
                    document.getElementById('booking-flight').value = '';
                    document.getElementById('booking-name').value = '';
                    document.getElementById('booking-email').value = '';
                    document.getElementById('booking-phone').value = '';
                    setTimeout(() => loadMyBookings(), 500);
                } else {
                    notify('‚ùå –û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
            } catch {
                notify('‚ÑπÔ∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ–∑–¥–∞—é –¥–µ–º–æ‚Äë–±–∏–ª–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ', 'warning');
                DEMO_BOOKINGS.unshift({
                    id: DEMO_BOOKINGS.length + 1,
                    booking_number: 'BK-LOCAL-' + Date.now(),
                    passenger_name: name,
                    passenger_email: email,
                    passenger_phone: phone,
                    status: '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û'
                });
                renderBookings(document.getElementById('bookings-list'), DEMO_BOOKINGS);
            }
        }
    </script>
</body>
</html>
